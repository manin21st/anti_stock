<!-- Tab: Config (System & Strategy) -->
<div id="tab-config" class="tab-content">
    <div class="settings-grid">

        <!-- Left: System Settings (Fixed Layout) -->
        <section class="card system-card">
            <h2><i class="fas fa-cog"></i> 시스템 설정 (System)</h2>
            <div class="system-options">
                <div class="option-group">
                    <label class="group-label">투자 모드</label>
                    <div class="radio-group">
                        <label><input type="radio" name="env_type" value="real" disabled> 실전투자</label>
                        <label><input type="radio" name="env_type" value="paper" disabled> 모의투자</label>
                    </div>
                </div>
                <div class="option-group">
                    <label class="group-label">거래소</label>
                    <div class="radio-group">
                        <label><input type="radio" name="market_type" value="KRX" checked> 정규장 (KRX)</label>
                        <label><input type="radio" name="market_type" value="NXT"> 대체거래소 (NXT)</label>
                    </div>
                </div>
                <div class="option-group">
                    <label class="group-label">종목 선정</label>
                    <label><input type="checkbox" id="use_auto_scanner"> 자동 선정 (Auto-Scanner)</label>
                </div>
                <div class="option-group" id="scanner-mode-group" style="display: none;">
                    <label class="group-label">스캐너 모드</label>
                    <div class="radio-group">
                        <label><input type="radio" name="scanner_mode" value="volume" checked> 거래량 상위</label>
                        <label><input type="radio" name="scanner_mode" value="gainers"> 급등주 상위</label>
                    </div>
                </div>
                <div class="option-group">
                    <label class="group-label">알림 설정 (Telegram)</label>
                    <label><input type="checkbox" id="enable_trade_alert"> 매매 알림</label>
                    <label><input type="checkbox" id="enable_system_alert"> 시스템 알림</label>
                </div>
                <div class="restart-section" style="margin-top: 20px;">
                    <p class="restart-note"><i class="fas fa-exclamation-triangle"></i> 설정 변경 후에는 시스템을 재시작해야 적용됩니다.</p>
                </div>
            </div>
        </section>

        <!-- Right: Strategy Configuration -->
        <section class="card config-card" style="display: flex; flex-direction: column; overflow: hidden;">
            <!-- Strategy Toolbar -->
            <div class="strategy-toolbar">
                <div class="strategy-toolbar-left">
                    <span class="strategy-label"><i class="fas fa-chess-knight"></i> 전략 선택</span>
                    <select id="strategy-select-dropdown" class="strategy-select" onchange="selectStrategy(this.value)">
                        <!-- Options Loaded by JS -->
                    </select>

                    <!-- Active Status Indicator -->
                    <span id="badge-active-strategy" class="status-active-text" style="display: none;">
                        <i class="fas fa-check-circle"></i> 실행중
                    </span>
                </div>

                <div class="strategy-toolbar-right">
                    <!-- Activate Button -->
                    <button id="btn-activate-strategy" onclick="activateStrategy()" class="btn-activate"
                        style="display: none;" title="이 전략 실행 적용">
                        <i class="fas fa-bolt"></i> 실행 적용
                    </button>

                    <!-- Action Buttons Group -->
                    <div class="action-group">
                        <button onclick="createNewStrategy()" class="tool-btn primary" title="새 전략 추가">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button onclick="renameStrategyUI()" class="tool-btn" title="전략 이름 변경">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteStrategy()" class="tool-btn danger" title="전략 삭제">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Strategy Editor Content -->
            <div id="editor-area" style="flex: 1; overflow-y: auto; display: none; padding-right: 5px;">

                <!-- Variables Section -->
                <div id="section-variables" class="section-card collapsed" style="padding: 15px; margin-bottom: 15px;">
                    <h3 onclick="toggleSection('section-variables')"
                        style="cursor: pointer; font-size: 1rem; margin-top: 0; margin-bottom: 0; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span><i class="fas fa-sliders-h"></i> 변수 설정 (Variables)</span>
                        <i class="fas fa-chevron-down chevron"></i>
                    </h3>
                    <div class="section-content"
                        style="margin-top: 15px; border-top: 1px solid #f1f5f9; padding-top: 15px;">
                        <table class="var-table">
                            <thead>
                                <tr>
                                    <th>변수명</th>
                                    <th>값</th>
                                    <th style="width: 40px;"></th>
                                </tr>
                            </thead>
                            <tbody id="variables-body">
                                <!-- Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Rules Section -->
                <div id="section-rules" class="section-card" style="padding: 15px; margin-bottom: 0;">
                    <h3 onclick="toggleSection('section-rules')"
                        style="cursor: pointer; font-size: 1rem; margin-top: 0; margin-bottom: 0; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span><i class="fas fa-code-branch"></i> 로직 구성 (Logic Rules)</span>
                        <i class="fas fa-chevron-down chevron"></i>
                    </h3>

                    <div class="section-content"
                        style="margin-top: 15px; border-top: 1px solid #f1f5f9; padding-top: 15px;">
                        <div class="edit-tabs" style="margin-bottom: 15px;">
                            <button class="edit-tab-btn active" onclick="switchTab('watch_conditions')">감시 조건</button>
                            <button class="edit-tab-btn" onclick="switchTab('entry_conditions')">진입 조건</button>
                            <button class="edit-tab-btn" onclick="switchTab('exit_conditions')">청산 조건</button>
                        </div>

                        <!-- Watch Conditions -->
                        <div id="watch_conditions" class="edit-tab-content active">
                            <div class="rule-card" style="padding: 15px;">
                                <div class="rule-header">
                                    <span class="rule-label">설명 (Description)</span>
                                    <button id="watch_conditions_llm_btn" class="small-btn"
                                        style="border:1px solid #ddd; background:white;"
                                        onclick="generateExpression('watch_conditions')">
                                        <i class="fas fa-magic" style="color:#d946ef;"></i> AI 생성
                                    </button>
                                </div>
                                <textarea id="watch_conditions_desc" class="rule-desc"
                                    onchange="updateRuleBlock('watch_conditions', 'desc', this.value)"></textarea>

                                <div class="rule-header" style="margin-top: 15px;">
                                    <span class="rule-label">조건 수식 (Condition)</span>
                                </div>
                                <textarea id="watch_conditions_code" class="rule-code"
                                    onchange="updateRuleBlock('watch_conditions', 'code', this.value)"></textarea>
                            </div>
                        </div>

                        <!-- Entry Conditions -->
                        <div id="entry_conditions" class="edit-tab-content">
                            <div class="rule-card" style="padding: 15px;">
                                <div class="rule-header">
                                    <span class="rule-label">설명 (Description)</span>
                                    <button id="entry_conditions_llm_btn" class="small-btn"
                                        style="border:1px solid #ddd; background:white;"
                                        onclick="generateExpression('entry_conditions')">
                                        <i class="fas fa-magic" style="color:#d946ef;"></i> AI 생성
                                    </button>
                                </div>
                                <textarea id="entry_conditions_desc" class="rule-desc"
                                    onchange="updateRuleBlock('entry_conditions', 'desc', this.value)"></textarea>

                                <div class="rule-header" style="margin-top: 15px;">
                                    <span class="rule-label">조건 수식 (Condition)</span>
                                </div>
                                <textarea id="entry_conditions_code" class="rule-code"
                                    onchange="updateRuleBlock('entry_conditions', 'code', this.value)"></textarea>

                                <div class="rule-header" style="margin-top: 15px;">
                                    <span class="rule-label">실행 수식 (Action)</span>
                                </div>
                                <textarea id="entry_conditions_action" class="rule-code" style="background:#0f172a;"
                                    onchange="updateRuleBlock('entry_conditions', 'action', this.value)"></textarea>
                            </div>
                        </div>

                        <!-- Exit Conditions -->
                        <div id="exit_conditions" class="edit-tab-content">
                            <div class="rule-card" style="padding: 15px;">
                                <div class="rule-header">
                                    <span class="rule-label">설명 (Description)</span>
                                    <button id="exit_conditions_llm_btn" class="small-btn"
                                        style="border:1px solid #ddd; background:white;"
                                        onclick="generateExpression('exit_conditions')">
                                        <i class="fas fa-magic" style="color:#d946ef;"></i> AI 생성
                                    </button>
                                </div>
                                <textarea id="exit_conditions_desc" class="rule-desc"
                                    onchange="updateRuleBlock('exit_conditions', 'desc', this.value)"></textarea>

                                <div class="rule-header" style="margin-top: 15px;">
                                    <span class="rule-label">조건 수식 (Condition)</span>
                                </div>
                                <textarea id="exit_conditions_code" class="rule-code"
                                    onchange="updateRuleBlock('exit_conditions', 'code', this.value)"></textarea>

                                <div class="rule-header" style="margin-top: 15px;">
                                    <span class="rule-label">실행 수식 (Action)</span>
                                </div>
                                <textarea id="exit_conditions_action" class="rule-code" style="background:#0f172a;"
                                    onchange="updateRuleBlock('exit_conditions', 'action', this.value)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Floating Save Button -->
    <button class="fab-save" onclick="saveConfig()" title="변경사항 저장">
        <i class="fas fa-save"></i>
    </button>
</div>